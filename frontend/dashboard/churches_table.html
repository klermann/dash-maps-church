<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <!-- Meta, title, CSS, favicons, etc. -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>DataTables | Gentelella</title>

  <!-- Bootstrap -->
  <link href="cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css">
  <link href="../vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link href="../vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
  <!-- NProgress -->
  <link href="../vendors/nprogress/nprogress.css" rel="stylesheet">
  <!-- iCheck -->
  <link href="../vendors/iCheck/skins/flat/green.css" rel="stylesheet">
  <!-- Datatables -->

  <link href="../vendors/datatables.net-bs/css/dataTables.bootstrap.min.css" rel="stylesheet">
  <link href="../vendors/datatables.net-buttons-bs/css/buttons.bootstrap.min.css" rel="stylesheet">
  <link href="../vendors/datatables.net-fixedheader-bs/css/fixedHeader.bootstrap.min.css" rel="stylesheet">
  <link href="../vendors/datatables.net-responsive-bs/css/responsive.bootstrap.min.css" rel="stylesheet">
  <link href="../vendors/datatables.net-scroller-bs/css/scroller.bootstrap.min.css" rel="stylesheet">

  <!-- Custom Theme Style -->
  <link href="../build/css/custom.min.css" rel="stylesheet">
</head>

<body class="nav-md">
  <div class="container body">
    <div class="main_container">

      <div class="col-md-3 left_col">
        <div class="left_col scroll-view">

          <div class="clearfix"></div>
          <!-- menu profile quick info -->
          <div id="profileContainer"></div>
          <!-- /menu profile quick info -->
          <br />

          <!-- sidebar menu -->
          <div id="sidebarMenu"></div>
          <!-- /sidebar menu -->

          <!-- /menu footer buttons -->
          <div id="sidebarFooter"></div>
          <!-- /menu footer buttons -->
        </div>
      </div>

      <!-- top navigation -->
      <div id="topNav"></div>
      <!-- /top navigation -->

      <!-- page content -->
      <div class="right_col" role="main">
        <div class="">
          <div class="page-title">
            <div class="title_left">
              <h3>Users <small>Some examples to get you started</small></h3>
            </div>

            <div class="title_right">
              <div class="col-md-5 col-sm-5 col-xs-12 form-group pull-right top_search">
                <div class="input-group">
                  <input type="text" class="form-control" placeholder="Search for...">
                  <span class="input-group-btn">
                    <button class="btn btn-secondary" type="button">Go!</button>
                  </span>
                </div>
              </div>
            </div>
          </div>

          <div class="clearfix"></div>

          <div class="row">

            <div class="col-md-12 col-sm-12 ">
              <div class="x_panel">
                <div class="x_title">
                  <h2>Button Example <small>Users</small></h2>
                  <ul class="nav navbar-right panel_toolbox">
                    <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                    </li>
                    <li class="dropdown">
                      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i
                          class="fa fa-wrench"></i></a>
                      <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                        <a class="dropdown-item" href="#">Settings 1</a>
                        <a class="dropdown-item" href="#">Settings 2</a>
                      </div>
                    </li>
                    <li><a class="close-link"><i class="fa fa-close"></i></a>
                    </li>
                  </ul>
                  <div class="clearfix"></div>
                </div>
                <div class="x_content">
                  <div class="row">
                    <div class="col-sm-12">
                      <div class="card-box table-responsive">
                        <p class="text-muted font-13 m-b-30">
                          The Buttons extension for DataTables provides a common set of options, API methods and styling
                          to display buttons on a page that will interact with a DataTable. The core library provides
                          the based framework upon which plug-ins can built.
                        </p>
                        <table id="datatable-buttons" class="table table-striped table-bordered" style="width:100%">
                          <thead>
                            <tr>
                              <th>Nome</th>
                              <th>Status</th>
                              <th>Endereço</th>
                              <th>Nº</th>
                              <th>Bairro</th>
                              <th>Cidade</th>
                              <th>Fone</th>
                              <th>Email</th>
                              <th>Ações</th>
                            </tr>
                          </thead>
                          <tbody id="table-body">
                            <!-- Os dados serão carregados aqui -->
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- /page content -->
      <!-- footer content -->
      <div id="footer"></div>
      <!-- /footer content -->
    </div>
  </div>
  </div>

  <!-- jQuery -->
  <script src="../vendors/jquery/dist/jquery.min.js"></script>
  <!-- Bootstrap -->
  <script src="../vendors/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  <!-- FastClick -->
  <script src="../vendors/fastclick/lib/fastclick.js"></script>
  <!-- NProgress -->
  <script src="../vendors/nprogress/nprogress.js"></script>
  <!-- iCheck -->
  <script src="../vendors/iCheck/icheck.min.js"></script>
  <!-- Datatables -->
  <script src="../vendors/datatables.net/js/jquery.dataTables.min.js"></script>
  <script src="../vendors/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
  <script src="../vendors/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
  <script src="../vendors/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>
  <script src="../vendors/datatables.net-buttons/js/buttons.flash.min.js"></script>
  <script src="../vendors/datatables.net-buttons/js/buttons.html5.min.js"></script>
  <script src="../vendors/datatables.net-buttons/js/buttons.print.min.js"></script>
  <script src="../vendors/datatables.net-fixedheader/js/dataTables.fixedHeader.min.js"></script>
  <script src="../vendors/datatables.net-keytable/js/dataTables.keyTable.min.js"></script>
  <script src="../vendors/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
  <script src="../vendors/datatables.net-responsive-bs/js/responsive.bootstrap.js"></script>
  <script src="../vendors/datatables.net-scroller/js/dataTables.scroller.min.js"></script>
  <script src="../vendors/jszip/dist/jszip.min.js"></script>
  <script src="../vendors/pdfmake/build/pdfmake.min.js"></script>
  <script src="../vendors/pdfmake/build/vfs_fonts.js"></script>

  <!-- Custom Theme Scripts -->
  <script src="../build/js/custom.min.js"></script>

  <!-- Scripts Customizados -->
  <script src="../build/js/load-components.js"></script>

  <script>
    const loadLocations = () => {
      const token = localStorage.getItem('authToken'); // Pegue o token do localStorage

      $.ajax({
        url: 'http://localhost:3000/api/churches', // URL da API
        method: 'GET',
        headers: {
          Authorization: `Bearer ${token}`, // Cabeçalho com o token
        },
        success: function (data) {
          console.log('Dados recebidos:', data);

          // Inicializar ou limpar tabela
          const table = $('#datatable-buttons').DataTable();
          table.clear();

          // Adicionar dados recebidos à tabela
          data.forEach((location) => {
            table.row.add([
              location.nome,
              location.status,
              location.endereco.logradouro,
              location.endereco.numero,
              location.endereco.bairro,
              location.endereco.cidade,
              location.contato.telefone,
              location.contato.email,
              `<button class="btn btn-warning btn-sm" onclick="editLocation('${location.id}')"><i class="fa fa-edit"></i></button>
           <button class="btn btn-danger btn-sm" onclick="deleteLocation('${location.id}')"><i class="fa fa-trash-o"></i></button>`
            ]).draw(); // Renderizar nova linha na tabela
          });
        },
        error: function (jqXHR) {
          console.error('Erro ao carregar os dados:', jqXHR.responseText);
          alert('Erro ao carregar os dados!');
        },
      });
    };

    const editLocation = (id) => {
      const token = localStorage.getItem('authToken');
      const updatedData = {
        nome: prompt('Digite o novo nome:'),
        status: prompt('Digite o novo status:'),
        // Você pode incluir mais campos se necessário
      };

      $.ajax({
        url: `http://localhost:3000/api/churches/${id}`,
        method: 'PUT',
        headers: {
          Authorization: `Bearer ${token}`,
        },
        contentType: 'application/json',
        data: JSON.stringify(updatedData),
        success: function () {
          alert('Localização atualizada com sucesso!');
          loadLocations(); // Recarrega a tabela
        },
        error: function (jqXHR) {
          console.error('Erro ao atualizar a localização:', jqXHR.responseText);
          alert('Erro ao atualizar a localização!');
        },
      });
    };

    const deleteLocation = (id) => {
      const token = localStorage.getItem('authToken');

      if (confirm('Tem certeza que deseja excluir esta localização?')) {
        $.ajax({
          url: `http://localhost:3000/api/churches/${id}`,
          method: 'DELETE',
          headers: {
            Authorization: `Bearer ${token}`,
          },
          success: function () {
            alert('Localização excluída com sucesso!');
            loadLocations(); // Recarrega a tabela
          },
          error: function (jqXHR) {
            console.error('Erro ao excluir a localização:', jqXHR.responseText);
            alert('Erro ao excluir a localização!');
          },
        });
      }
    };

    // Chame a função ao carregar a página
    $(document).ready(() => {
      $('#datatable-buttons').DataTable();
      loadLocations();
    });
  </script>
</body>
</html>